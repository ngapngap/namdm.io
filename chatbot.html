
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>BHXH Support Chatbot - NamTools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2563eb;
      --secondary-color: #64748b;
      --accent-color: #0ea5e9;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-accent: #f1f5f9;
      --bg-chat: #fafbfc;
      --border-color: #e2e8f0;
      --border-light: #f1f5f9;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --border-radius: 8px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      line-height: 1.7;
      color: var(--text-primary);
      background: var(--bg-secondary);
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 70px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-color);
      text-decoration: none;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius);
      transition: all 0.3s ease;
    }

    .back-btn:hover {
      background: var(--bg-accent);
      color: var(--primary-color);
    }

    /* Main Chat Container */
    .chat-container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 2rem;
      height: calc(100vh - 140px);
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-bottom: none;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      padding: 1.5rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-title {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .chat-title h1 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--success-color);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--success-color);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .chat-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .theme-selector {
      position: relative;
    }

    .theme-btn {
      background: var(--bg-accent);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      transition: all 0.3s ease;
    }

    .theme-btn:hover {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .theme-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-lg);
      min-width: 150px;
      z-index: 1000;
      display: none;
      margin-top: 0.5rem;
    }

    .theme-option {
      padding: 0.75rem 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background 0.3s ease;
    }

    .theme-option:hover {
      background: var(--bg-accent);
    }

    .color-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid var(--border-color);
    }

    /* Chat Messages */
    .chat-messages {
      flex: 1;
      background: var(--bg-chat);
      border: 1px solid var(--border-color);
      border-top: none;
      border-bottom: none;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .message-group.user {
      align-items: flex-end;
    }

    .message-group.bot {
      align-items: flex-start;
    }

    .message {
      max-width: 70%;
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      position: relative;
      word-wrap: break-word;
    }

    .message.user {
      background: var(--primary-color);
      color: white;
      border-bottom-right-radius: 0.25rem;
    }

    .message.bot {
      background: var(--bg-primary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-bottom-left-radius: 0.25rem;
    }

    .message-time {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    .message-group.user .message-time {
      text-align: right;
    }

    /* Chat Input */
    .chat-input-container {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      padding: 1.5rem 2rem;
    }

    .chat-input-wrapper {
      display: flex;
      gap: 1rem;
      align-items: flex-end;
    }

    .chat-input {
      flex: 1;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 1.5rem;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      font-family: var(--font-family);
      resize: none;
      outline: none;
      transition: all 0.3s ease;
      min-height: 44px;
      max-height: 120px;
    }

    .chat-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .send-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }

    .send-btn:hover {
      background: #1d4ed8;
      transform: scale(1.05);
    }

    .send-btn:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
      transform: none;
    }

    /* Welcome Message */
    .welcome-message {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      margin: 2rem 0;
    }

    .welcome-message h3 {
      color: var(--text-primary);
      margin-bottom: 1rem;
    }

    .welcome-message p {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    .quick-questions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    .quick-question {
      background: var(--bg-accent);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.3s ease;
    }

    .quick-question:hover {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    /* Loading Animation */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 1rem;
      border-bottom-left-radius: 0.25rem;
      max-width: 70%;
    }

    .typing-dots {
      display: flex;
      gap: 0.25rem;
    }

    .typing-dot {
      width: 6px;
      height: 6px;
      background: var(--text-muted);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typing {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-container {
        padding: 0 1rem;
      }

      .chat-container {
        padding: 0 1rem;
        margin: 1rem auto;
        height: calc(100vh - 110px);
      }

      .chat-header {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }

      .chat-controls {
        width: 100%;
        justify-content: flex-end;
      }

      .message {
        max-width: 85%;
      }

      .chat-input-container {
        padding: 1rem;
      }

      .quick-questions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-container">
      <a href="index.html" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Quay lại NamTools
      </a>
      <a href="#" class="logo">
        <i class="fas fa-robot"></i>
        BHXH Chatbot
      </a>
    </div>
  </header>

  <!-- Main Chat Container -->
  <div class="chat-container">
    <!-- Chat Header -->
    <div class="chat-header">
      <div class="chat-title">
        <div>
          <h1>BHXH Support Chatbot</h1>
          <div class="status-indicator">
            <div class="status-dot"></div>
            <span>Đang hoạt động</span>
          </div>
        </div>
      </div>
      <div class="chat-controls">
        <div class="theme-selector">
          <button class="theme-btn" onclick="toggleThemeDropdown()">
            <i class="fas fa-palette"></i>
            Theme
          </button>
          <div class="theme-dropdown" id="themeDropdown">
            <div class="theme-option" onclick="setTheme('#2563eb', 'Xanh dương')">
              <div class="color-dot" style="background: #2563eb;"></div>
              <span>Xanh dương</span>
            </div>
            <div class="theme-option" onclick="setTheme('#10b981', 'Xanh lá')">
              <div class="color-dot" style="background: #10b981;"></div>
              <span>Xanh lá</span>
            </div>
            <div class="theme-option" onclick="setTheme('#f59e0b', 'Vàng')">
              <div class="color-dot" style="background: #f59e0b;"></div>
              <span>Vàng</span>
            </div>
            <div class="theme-option" onclick="setTheme('#ef4444', 'Đỏ')">
              <div class="color-dot" style="background: #ef4444;"></div>
              <span>Đỏ</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Messages -->
    <div class="chat-messages" id="chatMessages">
      <div class="welcome-message">
        <h3><i class="fas fa-robot"></i> Chào mừng bạn đến với BHXH Support!</h3>
        <p>Tôi là chatbot hỗ trợ tư vấn về Bảo hiểm Xã hội. Bạn có thể hỏi tôi về:</p>
        <div class="quick-questions">
          <div class="quick-question" onclick="sendQuickQuestion('Cách đóng BHXH tự nguyện?')">
            Cách đóng BHXH tự nguyện?
          </div>
          <div class="quick-question" onclick="sendQuickQuestion('Thủ tục hưởng bảo hiểm thất nghiệp?')">
            Thủ tục hưởng bảo hiểm thất nghiệp?
          </div>
          <div class="quick-question" onclick="sendQuickQuestion('Tra cứu sổ BHXH online?')">
            Tra cứu sổ BHXH online?
          </div>
          <div class="quick-question" onclick="sendQuickQuestion('Quyền lợi thai sản BHXH?')">
            Quyền lợi thai sản BHXH?
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Input -->
    <div class="chat-input-container">
      <div class="chat-input-wrapper">
        <textarea 
          class="chat-input" 
          id="chatInput" 
          placeholder="Nhập câu hỏi của bạn về BHXH..."
          rows="1"
          onkeydown="handleKeyDown(event)"
          oninput="autoResize(this)"
        ></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentTheme = '#2563eb';
    const webhookURL = "https://bizflow.vn/webhook/webchat";
    
    // Session ID
    const sessionId = localStorage.getItem("chat_session") || (() => {
      const sid = "sid-" + Math.random().toString(36).substring(2, 10);
      localStorage.setItem("chat_session", sid);
      return sid;
    })();

    // Theme functions
    function toggleThemeDropdown() {
      const dropdown = document.getElementById('themeDropdown');
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }

    function setTheme(color, name) {
      currentTheme = color;
      document.documentElement.style.setProperty('--primary-color', color);
      toggleThemeDropdown();
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('themeDropdown');
      const themeSelector = document.querySelector('.theme-selector');
      if (!themeSelector.contains(event.target)) {
        dropdown.style.display = 'none';
      }
    });

    // Message functions
    function addMessage(text, isUser = false) {
      const messagesContainer = document.getElementById('chatMessages');
      const messageGroup = document.createElement('div');
      messageGroup.className = `message-group ${isUser ? 'user' : 'bot'}`;

      const message = document.createElement('div');
      message.className = `message ${isUser ? 'user' : 'bot'}`;
      message.textContent = text;

      const time = document.createElement('div');
      time.className = 'message-time';
      time.textContent = new Date().toLocaleTimeString('vi-VN', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });

      messageGroup.appendChild(message);
      messageGroup.appendChild(time);
      messagesContainer.appendChild(messageGroup);

      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function showTypingIndicator() {
      const messagesContainer = document.getElementById('chatMessages');
      const typingIndicator = document.createElement('div');
      typingIndicator.className = 'message-group bot';
      typingIndicator.id = 'typingIndicator';
      
      typingIndicator.innerHTML = `
        <div class="typing-indicator">
